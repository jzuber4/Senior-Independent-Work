{% extends "trees/base.html" %}
{% load staticfiles %}
{% load compress %} 

{% block js %}
{{ block.super }}
{% compress js %}
<script type="text/coffeescript" charset="utf-8" src="{% static "trees/scripts/trees.coffee" %}"></script>
<script type="text/coffeescript">
$ ->
    # clear preset value, question is likely new
    $("#inputAnswer").val("")

    tree = new Tree("treeContainer", {{structure|safe}});        

    # click function that allows user to select nodes (and fill input)
    answer = []

    onClick = (d) ->
        # disallow nodes without names
        unless d.name?
            return

        # toggle selected status of node
        index = answer.indexOf d.name
        if index == -1
            tree.select tree.get(d.name)[0]
            answer.push d.name
        else
            tree.deselect tree.get(d.name)[0]
            answer.splice index, 1

        # update answer
        $("#inputAnswer").val answer

    tree.nodeOnClick onClick
       
</script>
{% endcompress %}
{% endblock %}

{% block title %}Question{% endblock %} 

{% block content %}
<h1>Binary Search Trees</h1>
<p>{{prompt}}</p>
<p>Click to select nodes, or type in a comma separated series of keys.</p>
<form action="{% url 'trees.views.question' pk %}" method="post" class="form">
    {% csrf_token %}
    <div class="form-group">
        <input name="answer" type="text" class="form-control" id="inputAnswer" placeholder="Answer">
    </div>
    <button type="submit" class="btn btn-primary">
        Submit
    </button>
</form>
<div id="treeContainer"></div>
{% endblock %}

