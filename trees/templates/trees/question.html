{% extends "trees/base.html" %}
{% load staticfiles %}
{% load compress %} 

{% block js %}
{{ block.super }}
{% compress js %}
<script type="text/coffeescript" charset="utf-8" src="{% static "trees/scripts/trees.coffee" %}"></script>
<script type="text/coffeescript">
$ ->
    answer = []
    # clear preset value, question is likely new
    $("#inputAnswer").val("")

    # click function that allows user to select nodes (and fill input)
    onClick = (d) ->
        # only do for valid nodes
        if not d.name?
            return
        
        # select or deselect node
        if answer.indexOf(d.name) != -1
            d3.select(this).attr("class", "node")
            answer.splice(answer.indexOf(d.name), 1)
        else
            d3.select(this).attr("class", "node clicked")
            answer.push(d.name)

        $("#inputAnswer").val(answer.join(","))
        
        
    tree = new Tree("treeContainer", {{structure|safe}}, onClick);        
</script>
{% endcompress %}
{% endblock %}

{% block title %}Question{% endblock %} 

{% block content %}
<h1>Binary Search Trees</h1>
<p>{{prompt}}</p>
<p>Click to select nodes, or type in a comma separated series of keys.</p>
<form action="{% url 'trees.views.question' pk %}" method="post" class="form">
    {% csrf_token %}
    <div class="form-group">
        <input name="answer" type="text" class="form-control" id="inputAnswer" placeholder="Answer">
    </div>
    <button type="submit" class="btn btn-primary">
        Submit
    </button>
</form>
<div id="treeContainer"></div>
{% endblock %}

